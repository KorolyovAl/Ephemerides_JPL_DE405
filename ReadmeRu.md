<a id="start"></a>
Программа для вычисления координат и скоростей планет солнечной системы из эфемерид НАСА JPL [DE405](https://ssd.jpl.nasa.gov/ftp/eph/planets/ascii/de405/). Все координаты вычисляются относительно барицентра солнечной системы.\
Для работы программы файлы эфемерид необходимо разместить в папку files в корне проекта (путь к файлам задаётся в initialization.cpp и reading_ascp.cpp). Результаты сохраняются в папку results (если такой папки нет, надо её создать).

---

[Начальные данные](#ch1)\
[Формат файлов эфемерид](#ch2)\
[Вычисление координат и скоростей](#ch3)\
[Результаты](#ch4)

---
<a id="ch1"></a>
## Начальные данные  

Начальные данные задаются в файле "files/initial_data.txt".

На основе файла "header.405" формируется список объектов, для которых вычисляются координаты, в файле "files/initial_data.txt". Напротив каждого объекта прописывается флаг true/false, который указывает на то, будут ли для данного объекта вычисляться координаты.

Далее в начальных данных задаётся диапазон дат, в котором будут вычисляться координаты. Диапазон дат формируется на основе наличия файлов эфемерид. Каждый файл содержит в себе данные на 20-летний период времени.

[вверх](#start)

---
<a id="ch2"></a>
## Формат файлов эфемерид  

_1. Заголовочный файл header.405_

Файл header.405 разбит на несколько блоков, которые маркируются ключевым словом "GROUP".

В "GROUP   1030" приведены 3 числа: дата начала и конца эпохи в юлианском формате и продолжительность в днях для каждого блока коэффициентов в файлах ascp.

В "GROUP   1040" приведены некоторые дополнительные параметры для объектов, а в "GROUP   1041" записаны их численные значения.

В "GROUP   1050" содержится такая группа чисел:

     3   171   231   309   342   366   387   405   423   441   753   819   899
    14    10    13    11     8     7     6     6     6    13    11    10    10
     4     2     2     1     1     1     1     1     1     8     2     4     4

В этой группе числа разбиты по вертикальным тройкам для каждого тела соответственно. 

Рассмотрим пример:\
Первая вертикальная тройка чисел (3, 14, 4) предназначается для Меркурия. Коэффициенты для Меркурия начинаются с 3-го коэффициента в блоке (и до 170, 
как можно догадаться), всего коэффициентов для каждой координаты 14, а блочный интервал  в 32 дня разбит на 4 подинтервала, то есть для каждого 8-суточного 
подинтервала свой набор коэффициентов.\
Соответственно, номера коэффициентов для Венеры в блоке - с 171 по 230, по 10 коэффициентов на координату, подинтервалов 2 (каждый подинтервал = 16 дней).
И т.д.\
Коэффициенты для тел располагаются в следующем порядке:\
 Mercury,  Venus,  Earth-Moon barycenter,  Mars ,  Jupiter ,  Saturn,  Uranus,  Neptune,  Pluto,  Moon (geocentric),  Sun.

_2. Файлы коэффициентов ascp_

Например, файл ascp2000.405 состоит из блоков по 341 строк в каждом. Блок начинается со строки вида:

1   1018 

Где первое число – номер блока, второе число – количество коэффициентов в блоке (неизменно).\
Каждый блок содержит ряд коэффициентов для аппроксимации экваториальных прямоугольных координат (XYZ) планет Солнечной Системы  внутри 32-дневного интервала. \
Блок состоит из 340 строк по 3 коэффициента в строке, итого 1020 чисел, но два первых не используются.\
Файл ascp2000.405 начинается не с 1 января 2000 г, как можно было бы подумать, а с 24.12.1999 0:00 UTC.  

[вверх](#start)

---
<a id="ch3"></a>
## Вычисление координат и скоростей  

Алгоритм определения координат тела:\
Вычисляем номер нужного блока:\
Пусть\
MD0 = MJD(1999,12,24) – начальная юлианская дата файла ascp2000.405\
MD – нужная дата, на которую необходимо вычислить координаты.\
Interval = 32 (длина интервала в сутках, во время которого действителен отдельный блок коэффициентов), задаётся в файле header.405 в "GROUP 1030".\
Номер блока:\
NumerBlock =  Int((MD - md0) / Interval) + 1\
Начальная дата нужного блока:\
MD1 = MD0 + (NumerBlock - 1) * Interval

Определяем длину и номер подинтервала:\
subInterval = Interval / Nset_Body  -  длина подинтервала в сутках\
где Nset_Body – количество подинтервалов для конкретного тела (третья строка группы 1050 в header.405)\
Количество полных подинтервалов в блоке до нужной даты:\
podint = Int((MD - MD1) / subInterval)   
Начальная дата нужного подинтервала:\
Mdat = MD1 + podint * subInterval\
Сдвиг начала чтения коэффициентов с учетом подинтервала:\
IndBegin = 3 * Nkoef_Body * podint\
Где Nkoef_Body – количество коэффициентов для данного тела (вторая строка группы 1050 в header.405).

Например, определим барицентрические координаты Марса на 14.04.2023 0:00 UTС:\
MD0 = 58832.5\
MD = 60049\
NumerBlock = 39\
MD1 = 60048.5 - (39-ий блок начинается с этой даты)\
subinterval = 32 - (для Марса Nset_Body = 1)\
podint = 0 - (столько подинтервалов нужно пропустить)\
Mdat = 60048.5 - (нужны коэффициенты 1-го подинтервала, который начинается с этой даты)\
Из 39-го блока читаем коэффициенты с 309 по 341 (положение коэффициентов для Марса, первая строка группы 1050 в header.405)\
IndBegin = 0

Поскольку IndBegin = 0, читаем коэффициенты с самого начала: kX(от 1 до 11) для X, kY(от 1 до 11) для Y, kZ(от 1 до 11) для Z.

Получили три комплекта чисел по 11 штук в комплекте. Теперь дело за полиномами Чебышева.

Аргументом в полиномах Чебышева является нормированное время (от -1 до 1) внутри подинтервала:\
tau = 2 * (MD - Mdat) / subInterval - 1\
Для рассматриваемого примера tau = -0,96875

Коэффициентов 11 (для Марса), нужно 11 полиномов Чебышева.\
p(1) = 1\
p(2) = tau\
p(i) = 2 * tau * p(i - 1) - p(i - 2)\
И заодно 11 производных от полиномов Чебышева:\
pt(1) = 0\
pt(2) = 1\
pt(i) = 2 * (p(i - 1) + tau * pt(i - 1)) - pt(i - 2)

Вычисляем координаты и скорости:\
X = kX(1)*p(1) + … + kX(11)*p(11)\
X’ = kX(1)*pt(1) +…  + kX(11)*pt(11)\
Y =  kY(1)*p(1) + … + kY(11)*p(11)

В результате мы имеем X,Y,Z барицентрические в километрах. Для перехода к гелиоцентрической системе координат нужно аналогично вычислить барицентрический 
вектор Солнца и взять разницу векторов. Для перехода в эклиптическую систему координат вектор необходимо соответственно развернуть. Для Луны вектор вычисляется 
геоцентрический.

Вычисленный вектор скорости нужно разделить на коэффициент koefVelocity = subInterval / 2 * 86400 (получаем количество секунд в половине подинтервала), чтобы получить размерность км/сек.

Для рассматриваемого примера:\
Барицентрический вектор положения (-178770124.524,  155018292.718,  75929096.804)\
Барицентрический вектор скорости ( -15.98,  -14.08,  -6.03)  

[вверх](#start)

---
<a id="ch4"></a>
## Результаты  

Результаты сохраняются в директорию results. Для каждого тела формируется отдельный файл, в который записываются даты в юлианском и григорианском формате, барицентрические координаты тела и его скорость.  

Пример:\
julian_date = 2.42961650e+06 gregorian_date = 18.12.1939 X = 1.797734653534874618e+08   Y = 1.073376592823612988e+08   Z = 4.436277296654191613e+07   R = 2.140278663415088654e+08   VX = -1.219732e+01   VY = 2.025101e+01    VZ = 9.619936e+00

[вверх](#start)

---